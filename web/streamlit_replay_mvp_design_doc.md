# A股复盘可视化 Web MVP 设计文档

版本：v1.0\
生成时间：2026-02-21 08:15:39 UTC

------------------------------------------------------------------------

# 1. 项目目标

本项目用于构建 **个人交易复盘可视化 Web 界面 MVP**，
服务于事件驱动/题材交易者的每日复盘流程。

核心原则：

-   最小可用（MVP First）
-   工程化可扩展架构
-   与现有 DuckDB 数据库直接集成
-   不依赖前端经验（基于 Streamlit）

目标不是构建完整量化系统，而是打造：

> **可看盘 + 可扫市场 + 可记录复盘** 的每日工作台。

------------------------------------------------------------------------

# 2. 技术架构

## 2.1 技术选型

  层级       技术
  ---------- -----------
  前端UI     Streamlit
  图表       Plotly
  数据库     DuckDB
  数据处理   Pandas
  语言       Python

设计理由：

-   无需 Javascript
-   极低前端门槛
-   支持快速迭代
-   本地部署成本极低

------------------------------------------------------------------------

## 2.2 系统架构

    Streamlit UI
          ↓
    Service Layer (query + compute)
          ↓
    DuckDB Database
          ↓
    Daily Data Scripts (已存在)

------------------------------------------------------------------------

# 3. MVP 页面结构

仅实现 **3 个页面**。

------------------------------------------------------------------------

## 3.1 页面一：今日概览（Dashboard）

### 目标

快速判断市场阶段：主升 / 退潮 / 混沌。

### 组件

-   市场KPI卡片

字段：

-   成交额
-   上涨家数
-   下跌家数
-   涨停数
-   跌停数
-   炸板数
-   连板高度

------------------------------------------------------------------------

### 榜单

#### 涨停池

字段建议：

-   ts_code
-   name
-   连板数
-   amount
-   theme

#### 跌停池 / 大面股

------------------------------------------------------------------------

### 数据SQL示例

    SELECT count(*) FROM daily_bars
    WHERE trade_date = ? AND is_limit_up = 1

------------------------------------------------------------------------

## 3.2 页面二：个股复盘（Stock Viewer）

这是 MVP 的核心页面。

### 布局

    左侧：股票选择
    中间：K线图
    右侧：复盘笔记
    下方：数据表

------------------------------------------------------------------------

### 功能

#### 1）K线图

必须支持：

-   MA5 / MA10 / MA20 / MA60 以及自定义均线 
-   自定义K线颜色规则

建议颜色规则：

  状态       颜色
  ---------- ------
  普通上涨   红
  普通下跌   绿
  涨停       黄
  跌停       紫
  炸板       青

实现方式：

-   Plotly Candlestick
-   Overlay Scatter 标记特殊K线

------------------------------------------------------------------------

#### 2）数据表

字段：

-   open
-   high
-   low
-   close
-   pre_close
-   pct_chg
-   vol
-   amount
-   is_limit_up
-   is_limit_down
-   is_broken_limit

------------------------------------------------------------------------

#### 3）复盘笔记

新增表：notes

    CREATE TABLE notes (
        id INTEGER,
        trade_date TEXT,
        scope TEXT,
        key TEXT,
        content TEXT,
        created_at TIMESTAMP
    );

scope：

-   market
-   theme
-   stock

------------------------------------------------------------------------

## 3.3 页面三：复盘日志（Journal）

### 功能

-   按日期查看记录
-   按股票筛选
-   按主题筛选

------------------------------------------------------------------------

# 4. 数据模型设计

## 4.1 必需表

### daily_bars

    ts_code TEXT
    trade_date TEXT
    open DOUBLE
    high DOUBLE
    low DOUBLE
    close DOUBLE
    pre_close DOUBLE
    vol DOUBLE
    amount DOUBLE

------------------------------------------------------------------------

### 计算字段（可视为 View）

    is_limit_up
    is_limit_down
    is_broken_limit

------------------------------------------------------------------------

## 4.2 Notes 表

用于保存人工复盘信息。

------------------------------------------------------------------------

# 5. 目录结构设计

    replay-app/
    │
    ├─ app.py
    ├─ pages/
    │   ├─ dashboard.py
    │   ├─ stock_viewer.py
    │   └─ journal.py
    │
    ├─ services/
    │   ├─ db.py
    │   ├─ query.py
    │   └─ compute.py
    │
    ├─ components/
    │   └─ kline_chart.py
    │
    └─ config.py

------------------------------------------------------------------------

# 6. 核心模块职责

## db.py

负责：

-   DuckDB连接
-   SQL执行

------------------------------------------------------------------------

## query.py

负责：

-   查询日线数据
-   查询涨停榜
-   查询市场统计

------------------------------------------------------------------------

## compute.py

负责：

-   MA计算
-   涨跌停判断
-   炸板识别

------------------------------------------------------------------------

## kline_chart.py

封装 Plotly 图表。

------------------------------------------------------------------------

# 7. MVP 开发顺序（强制执行）

## 阶段1（必须先完成）

-   能选择股票
-   能显示K线

------------------------------------------------------------------------

## 阶段2

-   添加MA均线
-   添加涨停标记

------------------------------------------------------------------------

## 阶段3

-   Dashboard KPI
-   涨停榜

------------------------------------------------------------------------

## 阶段4

-   Notes 写入数据库

------------------------------------------------------------------------

# 8. 非MVP功能（禁止提前开发）

以下功能必须延后：

-   自动复权计算
-   AI归因
-   题材自动识别
-   舆情爬虫
-   策略信号系统
-   多周期回测

原因：

MVP目标是建立稳定的复盘工作流，而不是量化平台。

------------------------------------------------------------------------

# 9. 给 Cursor / Trae 的实现要求

-   使用 Python 3.10+
-   Streamlit 多页面模式
-   所有数据库访问走 services 层
-   图表必须封装组件
-   不允许 SQL 写在 UI 页面

------------------------------------------------------------------------

# 10. 设计哲学

本项目不是传统量化系统，而是：

> 人类认知驱动 + 机器结构化展示 的复盘工作台。

MVP 成功标准：

-   每日打开网页即可完成复盘
-   不再需要手写脚本生成图表
-   能长期沉淀个人交易日志

------------------------------------------------------------------------

# END
